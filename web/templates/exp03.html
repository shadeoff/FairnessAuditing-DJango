<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>定义准则</title>

  <!-- Mobile Specific Metas
================================================== -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Construction Html5 Template">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name=author content="Themefisher">
    <meta name=generator content="Themefisher Constra HTML Template v1.0">


    <!-- Template styles -->
    <link rel="stylesheet" href="../static/css/style.css">

    <!-- element-ui 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">



        <!-- ============== js ================= -->
    <!-- vue.js -->
    <script src="../static/js/vue.js"></script>

    <!-- axios.js -->
    <script src="../static/plugins/axios/axios-0.18.0.js"></script>

    <!-- element-ui 组件库 -->
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    
</head>

<body>
<div class="body-inner" id="app">
    
    <el-container>
        <!-- Header -->
        <header class="fixed-header">
            <h2>审计步骤2：设定审计指标</h2>
        </header>

        <!-- Main -->
        <el-main>
            <div class="main-contanier">
                <div class="task-area">
                    <div class="task-title">
                        <h1>设定审计指标</h1>
                    </div>
                    <div class="task-content">
                        <div class="task-content-description">
                            <!-- <p>描述....</p> -->
                            <!-- 调用metric和parameter -->
                            <!-- <p>......准则： [[metric]]</p>
                            <p>......参数c： [[parameter_c]]</p>


                            <div class="block image-container">
                                <el-image src="../static/images/standard.jpg" class="responsive-image"></el-image>
                            </div> -->

                            <!-- 选择适合的形式 -->
                            <!-- <hr> -->
                            <el-row :gutter="30">
                                <el-col :span="12">
                                    <div class="block image-container">
                                        <el-image src="../static/images/standard.jpg" class="responsive-image"></el-image>
                                    </div>
                                </el-col>
                                <el-col :span="12">
                                    <div style="margin-top: 50px;">
                                        <p>当 ① <b>两个样本特征差异足够小</b>，且 ② <b>模型对他们的分类结果不同</b>时，我们认为模型的分类结果不公平。</p>
                                        <p>在这一步骤中，审计人员需要指定审计时判定样本是否相似的指标。具体来说，这包含<b class="red">一个衡量样本特征差异的指标</b>，以及<b class="red">一个代表审计严格程度的参数c</b>。如左图所示，当样本差异≤c时判定两个样本相似。</p>
                                        <p>
                                            为了降低实验复杂性，本次试验中我们将代替您完成审计指标的选择：使用基于LR距离
                                            <el-tooltip class="item" effect="dark" placement="bottom">
                                                <i class="el-icon-question"></i>
                                                <template v-slot:content>
                                                    <div>
                                                        该距离对敏感属性子空间具有鲁棒性，即敏感属性和相关特征几乎不影响样本间差异。<br>
                                                        Yurochkin M, Bower A, Sun Y. 
                                                        Training individually fair ML models with sensitive subspace robustness[J]. 2020.
                                                    </div>
                                                </template> 
                                            </el-tooltip>
                                            的样本差异度量，设置c=1e-8
                                            <el-tooltip class="item" effect="dark" placement="bottom">
                                                <i class="el-icon-question"></i>
                                                <template v-slot:content>
                                                    <div>
                                                        这是一个足够小的c值，意味着审计人员找到的不公平样本需要非常相似，足够说明模型真正存在值得关注的歧视现象。
                                                    </div>
                                                </template> 
                                            </el-tooltip>
                                            。
                                        </p>
                                    </div>
                                </el-col>
                            </el-row>
                            <!-- <p>描述.......</p> -->
                        </div>
                    </div>
                </div>

                <div class="jump-area">
                    <div class="button-area">

                        <el-button type="warning" @click="onSubmit">下一步</el-button>

                    </div>
                </div>


            </div>


        </el-main>

    </el-container>




</div>


 <!-- 创建Vue对象 -->
     <script>
          axios.get('/api/csrf/').then(response => {
              axios.defaults.headers.common['X-CSRFToken'] = response.data.csrfToken;
            });
        new Vue({
            el:"#app",
            delimiters: ["[[", "]]"],
            data(){
                return{
                    form:{
                        metric:'LR',
                        parameter_c:1E-8,
                    },

                    metric:'LR',
                    parameter_c:1E-8,
                    rules:{
                        parameter_c:[
                            { required: true, message: '请输入值', trigger: 'blur' },
                            { validator: this.validateScientific, trigger: 'blur' },
                            { validator: this.validatePositive, trigger: 'blur' },
                            { validator: this.validateSuggestion, trigger: 'blur' },
                        ],
                    }
                };
            },
            methods:{
                // 配置科学计数法
                validateScientific(rule, value, callback) {
                    const scientificNotationRegex = /^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/;
                    const normalNumberRegex = /^[+-]?\d+(\.\d+)?$/;
                    if (scientificNotationRegex.test(value) || normalNumberRegex.test(value)) {
                        callback();
                    } else {
                        callback(new Error('请输入一个有效的数字或科学计数法表示的数字'));
                    }
                },
                validatePositive(rule, value, callback) {
                    if (parseFloat(value) > 0) {
                        callback();
                    } else {
                        callback(new Error('请输入一个大于0的数值'));
                    }
                },
                validateSuggestion(rule, value, callback) {
                    if (parseFloat(value) > 1e-5) {
                        this.$message({
                            message: '建议设置的值小于1e-5',
                            type: 'warning'
                        });
                        callback();
                    } else {
                        callback();
                    }
                },

                /*
                onSubmit(){
                    this.$refs.form.validate((valid) => {
                        if(valid){
                            let parameter_c_value = parseFloat(this.form.parameter_c);
                            console.log(this.form.metric)
                            axios.post("/api/exp03/",{dx: this.form.metric, eps: 1/ parameter_c_value}).then(resp =>{
                                console.log(resp.data);
                                window.location.href = '/page04/';
                            }).catch(err =>{
                                alert("发生错误")
                            });
                        }else{
                            console.log('表单验证失败');
                            return false;
                        }
                    });

                }

                */
                onSubmit(){
                    let parameter_c_value = parseFloat(this.form.parameter_c);
                    console.log(this.form.metric)
                    axios.post("/api/exp03/",{dx: this.form.metric, eps: 1/ parameter_c_value}).then(resp =>{
                        console.log(resp.data);
                        window.location.href = '/page04/';
                    }).catch(err =>{
                        alert("发生错误")
                    });



                }



            }
        })


     </script>
     <style>
        .red {
            color: red;
        }
    </style>
</body>

</html>